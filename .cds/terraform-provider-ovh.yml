name: terraform-provider-ovh
version: v2.0
workflow:

  terraform-provider-ovh:
    application: terraform-provider-ovh
    pipeline: terraform-provider-ovh
    parameters:
      testargs: ""

  terraform-provider-ovh-check:
    pipeline: terraform-provider-ovh-check
    application: terraform-provider-ovh
    depends_on:
      - terraform-provider-ovh

  terraform-provider-ovh-presweep:
    pipeline: terraform-provider-ovh-sweep
    application: terraform-provider-ovh
    environment: acctests    
    depends_on:
      - terraform-provider-ovh-check

  # TODO: the website-test make target is broken.
  # pipeline is disable and further investigation is required
  # terraform-provider-ovh-website-test:
  #   pipeline: terraform-provider-ovh-website-test
  #   application: terraform-provider-ovh
  #   depends_on:
  #     - terraform-provider-ovh

  terraform-provider-ovh-TestAccCloudProjectCapabilities:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccCloudProjectCapabilities"
    depends_on:
      - terraform-provider-ovh-presweep

  terraform-provider-ovh-TestAccCloudProjectContainer:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccCloudProjectContainer"
    depends_on:
      - terraform-provider-ovh-presweep

  terraform-provider-ovh-TestAccCloudProjectDatabase:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccCloudProjectDatabase"
    depends_on:
      - terraform-provider-ovh-presweep


  terraform-provider-ovh-TestAccDataSourceCloudProjectFailoverIp:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccDataSourceCloudProjectFailoverIp"
    depends_on:
      - terraform-provider-ovh-presweep

  terraform-provider-ovh-TestAccCloudProjectKube:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccCloudProjectKube"
    depends_on:
      - terraform-provider-ovh-presweep

  terraform-provider-ovh-TestAccCloudProjectRegion:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccCloudProjectRegion"
    depends_on:
      - terraform-provider-ovh-presweep

  terraform-provider-ovh-TestAccDataCloudProjectUser:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccDataCloudProjectUser"
    depends_on:
      - terraform-provider-ovh-presweep

  terraform-provider-ovh-TestAccDedicated:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccDedicated"
    depends_on:
      - terraform-provider-ovh-presweep

  terraform-provider-ovh-TestAccDomain:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccDomain"
    depends_on:
      - terraform-provider-ovh-presweep

  terraform-provider-ovh-TestAccDataSourceHosting:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccDataSourceHosting"
    depends_on:
      - terraform-provider-ovh-presweep

  terraform-provider-ovh-TestAccDataSourceIpService:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccDataSourceIpService"
    depends_on:
      - terraform-provider-ovh-presweep

  terraform-provider-ovh-TestAccIpLoadbalancing:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccIpLoadbalancing"
    depends_on:
      - terraform-provider-ovh-presweep

  terraform-provider-ovh-TestAccMe:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccDataSourceDbaas"
    depends_on:
      - terraform-provider-ovh-presweep


  terraform-provider-ovh-TestAccVPS:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccVPS"
    depends_on:
      - terraform-provider-ovh-presweep

  terraform-provider-ovh-TestAccVrack:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccVrack"
    depends_on:
      - terraform-provider-ovh-presweep

  terraform-provider-ovh-TestAccCloudProjectNetwork:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccCloudProjectNetwork"
    depends_on:
      - terraform-provider-ovh-presweep

  terraform-provider-ovh-TestAccHostingPrivateDatabase:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccHostingPrivateDatabase"
    depends_on:
      - terraform-provider-ovh-presweep

  terraform-provider-ovh-TestAccCloudProjectWorkflowBackup:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccCloudProjectWorkflowBackup"
    depends_on:
      - terraform-provider-ovh-presweep

  terraform-provider-ovh-TestAccDbaas:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccDbaas"
    depends_on:
      - terraform-provider-ovh-presweep

  terraform-provider-ovh-postsweep:
    pipeline: terraform-provider-ovh-sweep
    application: terraform-provider-ovh
    environment: acctests    
    depends_on:
      - terraform-provider-ovh-check
      - terraform-provider-ovh-TestAccCloudProjectCapabilities
      - terraform-provider-ovh-TestAccCloudProjectContainer
      - terraform-provider-ovh-TestAccCloudProjectDatabase
      - terraform-provider-ovh-TestAccDataSourceCloudProjectFailoverIp
      - terraform-provider-ovh-TestAccCloudProjectKube
      - terraform-provider-ovh-TestAccCloudProjectRegion
      - terraform-provider-ovh-TestAccDataCloudProjectUser
      - terraform-provider-ovh-TestAccDedicated
      - terraform-provider-ovh-TestAccDomain
      - terraform-provider-ovh-TestAccDataSourceHosting
      - terraform-provider-ovh-TestAccDataSourceIpService
      - terraform-provider-ovh-TestAccIpLoadbalancing
      - terraform-provider-ovh-TestAccMe
      - terraform-provider-ovh-TestAccVPS
      - terraform-provider-ovh-TestAccVrack
      - terraform-provider-ovh-TestAccCloudProjectNetwork
      - terraform-provider-ovh-TestAccHostingPrivateDatabase
      - terraform-provider-ovh-TestAccCloudProjectWorkflowBackup
      - terraform-provider-ovh-TestAccDbaas


metadata:
  default_tags: git.branch,git.author

retention_policy: return (git_branch_exist == "false" and run_days_before < 2) or run_days_before < 365

hooks:
  terraform-provider-ovh:
  - type: Scheduler
    config:
      cron: 0 0 * * *
      payload: '{}'
      timezone: UTC    
  - type: RepositoryWebHook
    config:
      # don't trigger build on PRs
      eventFilter: push

notifications:
- type: vcs
  settings:
    on_success: always
  pipelines:
  - terraform-provider-ovh-check
- type: email
  pipelines:
  - terraform-provider-ovh-check
  - terraform-provider-ovh-TestAccCloudProjectCapabilities
  - terraform-provider-ovh-TestAccCloudProjectContainer
  - terraform-provider-ovh-TestAccCloudProjectDatabase
  - terraform-provider-ovh-TestAccDataSourceCloudProjectFailoverIp
  - terraform-provider-ovh-TestAccCloudProjectKube
  - terraform-provider-ovh-TestAccCloudProjectRegion
  - terraform-provider-ovh-TestAccDataCloudProjectUser
  - terraform-provider-ovh-TestAccDedicated
  - terraform-provider-ovh-TestAccDomain
  - terraform-provider-ovh-TestAccDataSourceHosting
  - terraform-provider-ovh-TestAccDataSourceIpService
  - terraform-provider-ovh-TestAccIpLoadbalancing
  - terraform-provider-ovh-TestAccMe
  - terraform-provider-ovh-TestAccVPS
  - terraform-provider-ovh-TestAccVrack
  - terraform-provider-ovh-TestAccCloudProjectNetwork
  - terraform-provider-ovh-TestAccHostingPrivateDatabase
  - terraform-provider-ovh-TestAccCloudProjectWorkflowBackup
  - terraform-provider-ovh-TestAccDbaas
  settings:
    on_success: never
    send_to_author: false
    recipients:
    - guillaume.allee@ovhcloud.com
