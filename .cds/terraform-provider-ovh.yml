name: terraform-provider-ovh
version: v2.0
workflow:

  terraform-provider-ovh:
    application: terraform-provider-ovh
    pipeline: terraform-provider-ovh
    parameters:
      testargs: ""

  check:
    pipeline: terraform-provider-ovh-check
    application: terraform-provider-ovh
    depends_on:
      - terraform-provider-ovh

  presweep:
    pipeline: terraform-provider-ovh-sweep
    application: terraform-provider-ovh
    environment: acctests    
    depends_on:
      - terraform-provider-ovh-check

  # TODO: the website-test make target is broken.
  # pipeline is disable and further investigation is required
  # terraform-provider-ovh-website-test:
  #   pipeline: terraform-provider-ovh-website-test
  #   application: terraform-provider-ovh
  #   depends_on:
  #     - terraform-provider-ovh

  TestAccCloudProjectCapabilities:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccCloudProjectCapabilities"
    depends_on:
      - terraform-provider-ovh-presweep

  TestAccCloudProjectContainer:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccCloudProjectContainer"
    depends_on:
      - terraform-provider-ovh-presweep

  TestAccCloudProjectDatabaseDatabase:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccCloudProjectDatabaseDatabase"
    depends_on:
      - terraform-provider-ovh-presweep

  TestAccCloudProjectDatabaseIntegration:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccCloudProjectDatabaseIntegration"
    depends_on:
      - terraform-provider-ovh-presweep

  TestAccCloudProjectDatabaseIpRestriction:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccCloudProjectDatabaseIpRestriction"
    depends_on:
      - terraform-provider-ovh-presweep

  TestAccCloudProjectDatabaseKafka:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccCloudProjectDatabaseKafka"
    depends_on:
      - terraform-provider-ovh-presweep

  TestAccCloudProjectDatabaseM3:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccCloudProjectDatabaseM3"
    depends_on:
      - terraform-provider-ovh-presweep

  TestAccCloudProjectDatabaseMongo:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccCloudProjectDatabaseMongo"
    depends_on:
      - terraform-provider-ovh-presweep

  TestAccCloudProjectDatabaseOpensearch:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccCloudProjectDatabaseOpensearch"
    depends_on:
      - terraform-provider-ovh-presweep

  TestAccCloudProjectDatabasePostgreSQL:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccCloudProjectDatabasePostgre"
    depends_on:
      - terraform-provider-ovh-presweep

  TestAccCloudProjectDatabaseRedis:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccCloudProjectDatabaseRedis"
    depends_on:
      - terraform-provider-ovh-presweep

  TestAccCloudProjectDatabaseUser:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccCloudProjectDatabaseUser"
    depends_on:
      - terraform-provider-ovh-presweep

  TestAccCloudProjectDatabaseSource:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccCloudProjectDatabaseDataSource"
    depends_on:
      - terraform-provider-ovh-presweep

  TestAccCloudProjectDatabase_basic:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccCloudProjectDatabase_basic"
    depends_on:
      - terraform-provider-ovh-presweep


  TestAccDataSourceCloudProjectFailoverIp:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccDataSourceCloudProjectFailoverIp"
    depends_on:
      - terraform-provider-ovh-presweep

  TestAccCloudProjectKube:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccCloudProjectKube"
    depends_on:
      - terraform-provider-ovh-presweep

  TestAccCloudProjectRegion:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccCloudProjectRegion"
    depends_on:
      - terraform-provider-ovh-presweep

  TestAccDataCloudProjectUser:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccDataCloudProjectUser"
    depends_on:
      - terraform-provider-ovh-presweep

  TestAccDedicated:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccDedicated"
    depends_on:
      - terraform-provider-ovh-presweep

  TestAccDomain:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccDomain"
    depends_on:
      - terraform-provider-ovh-presweep

  TestAccDataSourceHosting:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccDataSourceHosting"
    depends_on:
      - terraform-provider-ovh-presweep

  TestAccDataSourceIpService:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccDataSourceIpService"
    depends_on:
      - terraform-provider-ovh-presweep

  TestAccIpLoadbalancing:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccIpLoadbalancing"
    depends_on:
      - terraform-provider-ovh-presweep

  TestAccMe:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccDataSourceDbaas"
    depends_on:
      - terraform-provider-ovh-presweep


  TestAccVPS:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccVPS"
    depends_on:
      - terraform-provider-ovh-presweep

  TestAccVrack:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccVrack"
    depends_on:
      - terraform-provider-ovh-presweep

  TestAccCloudProjectNetwork:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccCloudProjectNetwork"
    depends_on:
      - terraform-provider-ovh-presweep

  TestAccHostingPrivateDatabase:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccHostingPrivateDatabase"
    depends_on:
      - terraform-provider-ovh-presweep

  TestAccCloudProjectWorkflowBackup:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccCloudProjectWorkflowBackup"
    depends_on:
      - terraform-provider-ovh-presweep

  TestAccDbaas:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccDbaas"
    depends_on:
      - terraform-provider-ovh-presweep

  postsweep:
    pipeline: terraform-provider-ovh-sweep
    application: terraform-provider-ovh
    environment: acctests    
    depends_on:
      - TestAccCloudProjectCapabilities
      - TestAccCloudProjectContainer
      - TestAccCloudProjectDatabaseDatabase
      - TestAccCloudProjectDatabaseIntegration
      - TestAccCloudProjectDatabaseIpRestriction
      - TestAccCloudProjectDatabaseKafka
      - TestAccCloudProjectDatabaseM3
      - TestAccCloudProjectDatabaseMongo
      - TestAccCloudProjectDatabaseOpensearch
      - TestAccCloudProjectDatabasePostgreSQL
      - TestAccCloudProjectDatabaseRedis
      - TestAccCloudProjectDatabaseUser
      - TestAccCloudProjectDatabaseSource
      - TestAccCloudProjectDatabase_basic
      - TestAccDataSourceCloudProjectFailoverIp
      - TestAccCloudProjectKube
      - TestAccCloudProjectRegion
      - TestAccDataCloudProjectUser
      - TestAccDedicated
      - TestAccDomain
      - TestAccDataSourceHosting
      - TestAccDataSourceIpService
      - TestAccIpLoadbalancing
      - TestAccMe
      - TestAccVPS
      - TestAccVrack
      - TestAccCloudProjectNetwork
      - TestAccHostingPrivateDatabase
      - TestAccCloudProjectWorkflowBackup
      - TestAccDbaas
metadata:
  default_tags: git.branch,git.author

retention_policy: return (git_branch_exist == "false" and run_days_before < 2) or run_days_before < 365

hooks:
  terraform-provider-ovh:
  - type: Scheduler
    config:
      cron: 0 0 * * *
      payload: '{}'
      timezone: UTC    
  - type: RepositoryWebHook
    config:
      # don't trigger build on PRs
      eventFilter: push

notifications:
- type: vcs
  settings:
    on_success: always
  pipelines:
  - terraform-provider-ovh-check
- type: email
  pipelines:
  - terraform-provider-ovh-check
  - TestAccCloudProjectCapabilities
  - TestAccCloudProjectContainer
  - TestAccCloudProjectDatabaseDatabase
  - TestAccCloudProjectDatabaseIntegration
  - TestAccCloudProjectDatabaseIpRestriction
  - TestAccCloudProjectDatabaseKafka
  - TestAccCloudProjectDatabaseM3
  - TestAccCloudProjectDatabaseMongo
  - TestAccCloudProjectDatabaseOpensearch
  - TestAccCloudProjectDatabasePostgreSQL
  - TestAccCloudProjectDatabaseRedis
  - TestAccCloudProjectDatabaseUser
  - TestAccCloudProjectDatabaseSource
  - TestAccCloudProjectDatabase_basic
  - TestAccDataSourceCloudProjectFailoverIp
  - TestAccCloudProjectKube
  - TestAccCloudProjectRegion
  - TestAccDataCloudProjectUser
  - TestAccDedicated
  - TestAccDomain
  - TestAccDataSourceHosting
  - TestAccDataSourceIpService
  - TestAccIpLoadbalancing
  - TestAccMe
  - TestAccVPS
  - TestAccVrack
  - TestAccCloudProjectNetwork
  - TestAccHostingPrivateDatabase
  - TestAccCloudProjectWorkflowBackup
  - TestAccDbaas
  settings:
    on_success: never
    send_to_author: false
    recipients:
    - guillaume.allee@ovhcloud.com
