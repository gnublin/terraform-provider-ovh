name: terraform-provider-ovh
version: v2.0
workflow:

  terraform-provider-ovh:
    application: terraform-provider-ovh
    pipeline: terraform-provider-ovh
    parameters:
      testargs: ""

  check:
    pipeline: terraform-provider-ovh-check
    application: terraform-provider-ovh
    depends_on:
      - terraform-provider-ovh

  presweep:
    pipeline: terraform-provider-ovh-sweep
    application: terraform-provider-ovh
    environment: acctests    
    depends_on:
      - check

  # TODO: the website-test make target is broken.
  # pipeline is disable and further investigation is required
  # terraform-provider-ovh-website-test:
  #   pipeline: terraform-provider-ovh-website-test
  #   application: terraform-provider-ovh
  #   depends_on:
  #     - terraform-provider-ovh

  TestAccCloudProjectCapabilities:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccCloudProjectCapabilities"
    depends_on:
      - presweep

  TestAccCloudProjectContainer:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccCloudProjectContainer"
    depends_on:
      - presweep

  TestAccCloudProjectDatabaseDatabase:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccCloudProjectDatabaseDatabase"
    depends_on:
      - presweep

  TestAccCloudProjectDatabaseIntegration:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccCloudProjectDatabaseIntegration"
    depends_on:
      - presweep

  TestAccCloudProjectDatabaseIpRestriction:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccCloudProjectDatabaseIpRestriction"
    depends_on:
      - presweep

  TestAccCloudProjectDatabaseKafka:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccCloudProjectDatabaseKafka"
    depends_on:
      - presweep

  TestAccCloudProjectDatabaseM3:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccCloudProjectDatabaseM3"
    depends_on:
      - presweep

  TestAccCloudProjectDatabaseMongo:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccCloudProjectDatabaseMongo"
    depends_on:
      - presweep

  TestAccCloudProjectDatabaseOpensearch:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccCloudProjectDatabaseOpensearch"
    depends_on:
      - presweep

  TestAccCloudProjectDatabasePostgreSQL:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccCloudProjectDatabasePostgre"
    depends_on:
      - presweep

  TestAccCloudProjectDatabaseRedis:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccCloudProjectDatabaseRedis"
    depends_on:
      - presweep

  TestAccCloudProjectDatabaseUser:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccCloudProjectDatabaseUser"
    depends_on:
      - presweep

  TestAccCloudProjectDatabaseSource:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccCloudProjectDatabaseDataSource"
    depends_on:
      - presweep

  TestAccCloudProjectDatabase_basic:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccCloudProjectDatabase_basic"
    depends_on:
      - presweep


  TestAccDataSourceCloudProjectFailoverIp:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccDataSourceCloudProjectFailoverIp"
    depends_on:
      - presweep

  TestAccCloudProjectKube:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccCloudProjectKube"
    depends_on:
      - presweep

  TestAccCloudProjectRegion:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccCloudProjectRegion"
    depends_on:
      - presweep

  TestAccDataCloudProjectUser:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccDataCloudProjectUser"
    depends_on:
      - presweep

  TestAccDedicated:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccDedicated"
    depends_on:
      - presweep

  TestAccDomain:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccDomain"
    depends_on:
      - presweep

  TestAccDataSourceHosting:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccDataSourceHosting"
    depends_on:
      - presweep

  TestAccDataSourceIpService:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccDataSourceIpService"
    depends_on:
      - presweep

  TestAccIpLoadbalancing:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccIpLoadbalancing"
    depends_on:
      - presweep

  TestAccMe:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccDataSourceDbaas"
    depends_on:
      - presweep


  TestAccVPS:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccVPS"
    depends_on:
      - presweep

  TestAccVrack:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccVrack"
    depends_on:
      - presweep

  TestAccCloudProjectNetwork:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccCloudProjectNetwork"
    depends_on:
      - presweep

  TestAccHostingPrivateDatabase:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccHostingPrivateDatabase"
    depends_on:
      - presweep

  TestAccCloudProjectWorkflowBackup:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccCloudProjectWorkflowBackup"
    depends_on:
      - presweep

  TestAccDbaas:
    pipeline: terraform-provider-ovh-testacc
    one_at_a_time: true
    application: terraform-provider-ovh
    environment: acctests
    parameters:
      testargs: "-run TestAccDbaas"
    depends_on:
      - presweep

  postsweep:
    pipeline: terraform-provider-ovh-sweep
    application: terraform-provider-ovh
    environment: acctests    
    depends_on:
      - TestAccCloudProjectCapabilities
      - TestAccCloudProjectContainer
      - TestAccCloudProjectDatabaseDatabase
      - TestAccCloudProjectDatabaseIntegration
      - TestAccCloudProjectDatabaseIpRestriction
      - TestAccCloudProjectDatabaseKafka
      - TestAccCloudProjectDatabaseM3
      - TestAccCloudProjectDatabaseMongo
      - TestAccCloudProjectDatabaseOpensearch
      - TestAccCloudProjectDatabasePostgreSQL
      - TestAccCloudProjectDatabaseRedis
      - TestAccCloudProjectDatabaseUser
      - TestAccCloudProjectDatabaseSource
      - TestAccCloudProjectDatabase_basic
      - TestAccDataSourceCloudProjectFailoverIp
      - TestAccCloudProjectKube
      - TestAccCloudProjectRegion
      - TestAccDataCloudProjectUser
      - TestAccDedicated
      - TestAccDomain
      - TestAccDataSourceHosting
      - TestAccDataSourceIpService
      - TestAccIpLoadbalancing
      - TestAccMe
      - TestAccVPS
      - TestAccVrack
      - TestAccCloudProjectNetwork
      - TestAccHostingPrivateDatabase
      - TestAccCloudProjectWorkflowBackup
      - TestAccDbaas
metadata:
  default_tags: git.branch,git.author

retention_policy: return (git_branch_exist == "false" and run_days_before < 2) or run_days_before < 365

hooks:
  terraform-provider-ovh:
  - type: Scheduler
    config:
      cron: 0 0 * * *
      payload: '{}'
      timezone: UTC    
  - type: RepositoryWebHook
    config:
      # don't trigger build on PRs
      eventFilter: push

notifications:
- type: vcs
  settings:
    on_success: always
  pipelines:
    - check
